$(document).ready(function(){function s(b,a,g){if(3>arguments.length||g>=b.l.length){var h=b.l.length;b.l[h]=a;c.insertToList(b,a,h)}else{list.push(b.l[b.l.length]);for(h=b.l.length-1;h>g;h-=1){var d=b,e=a,f=h;d.l[f]=e;c.insertToList(d,e,f)}b.l[g]=a;c.insertToList(b,a,g)}}function n(){SC.get("/tracks",{q:$("#searchterm").val()},function(b){k.l.splice(0,k.l.length);$(".searchlist").html("");d("t.len "+b.length);var a;for(a=0;a<b.length;a+=1)b[a].streamable&&s(k,b[a])})}function e(b,w){for(var g in m)a[g]=
m[g];a.i=w;d("cp + q: i - "+a.i+" | c - "+a.c+" | t - "+a.ct);d("cp i: "+a.i+" t: "+a.ct+" l: "+a.l[0].id);a.ct.id&&SC.stream("/tracks/"+a.ct.id,{onload:function(){d("onload")},onfinish:function(){d("finish");t()},onplay:function(){d("onplay")}},function(b){a.cto&&a.cto.stop();a.cto=b;a.cto.play();a.cto.setVolume($(".volume").val());c.activate();c.buttonPress();c.nowplaying();c.currentTimePos("reset")})}function p(){e(u($(".selected").parent()),l)}function t(){a.i===a.l.length?1===f&&e(a,0):2===f?
e(a,a.i):e(a,a.i+1);c.nowplaying();c.currentTimePos()}function x(b){if("string"===typeof b)return b;if("[object Array]"===Object.prototype.toString.call(b)){if(b===k)return".searchlist";if(b===q)return".playlist";d("you have no class name array "+b[0])}else{if(b.hasClass("searchlist"))return".searchlist";if(b.hasClass("playlist"))return".playlist";d("you have no class name obj "+b.attr("class"))}}function v(b){var a=Math.floor(b/1E3)%60;b=Math.floor(b/1E3/60);return(10>b?"0"+b:b)+":"+(10>a?"0"+a:
a)}function u(b){if(b.hasClass("searchlist"))return k;if(b.hasClass("playlist"))return q;d("you have no class "+b.attr("class"))}var d=function(b){console.log(b)};SC.initialize({client_id:"d38e1193271880ed4a4571398d56d589",client_secret:"a7185a452c47434d8023fe41c018fa5b",redirect_uri:"http://darcu.net/wip/soundcloudapi/",access_token:"1-36306-882870-ec5630d18edc67175",scope:"non-expiring"});SC.isConnected()&&SC.get("/me",function(b){$("#nowplaying").after('<input type="button" class="statusbar ctrl login" id="userLogoff" value="'+
b.username+'">')});var m={c:null,l:[]},k=Object.create(m,{c:{value:".searchlist"}}),q=Object.create(m,{c:{value:".playlist"}}),a=Object.create(m,{index:{writable:!0,value:null},ct:{writable:!0,value:null},i:{get:function(){if(null!==this.index)return this.index},set:function(b){if(b&&b<=this.l.length)this.index=b;else throw"value bigger than list";if(this.l)this.ct=this.l[b];else throw"no list to set";}},cto:{writable:!0,value:null}}),l,f=0,r=!1,c={insertToList:function(b,a,c){$(b.c+" li").length?
$(b.c+" li").eq(c-1).after('<li class="playlistitem" id="tr'+c+'">'+a.title+'<span class="listuser">'+a.user.username+'</span><a href="#" id="playbutton" class="listbutton">\u25ba</a>'+(".searchlist"===b.c?'<a href="#" id="addbutton" class="listbutton">\u2605</a>':'<a href="#" id="moveup" class="listbutton">\u25b2</a><a href="#" id="movedown" class="listbutton">\u25bc</a><a href="#" id="remove" class="listbutton">&#9473;</a></li>')):$(b.c).append('<li class="playlistitem" id="tr'+c+'">'+a.title+'<span class="listuser">'+
a.user.username+'</span><a href="#" id="playbutton" class="listbutton">\u25ba</a>'+(".searchlist"===b.c?'<a href="#" id="addbutton" class="listbutton">\u2605</a>':'<a href="#" id="moveup" class="listbutton">\u25b2</a><a href="#" id="movedown" class="listbutton">\u25bc</a><a href="#" id="remove" class="listbutton">&#9473;</a></li>'))},removeFromList:function(b,a){$(b.c+" li").eq(a).remove()},buttonPress:function(){switch(f){case 0:$("#repeat").toggleClass("active",!1);$("#repeat").prop("value","\u2941");
break;case 1:$("#repeat").toggleClass("active",!0);break;case 2:$("#repeat").prop("value","\u2941 1")}a.cto&&(r?$("#play").prop("value","play"):$("#play").prop("value","pause"))},activate:function(){$(".list li").removeClass("active");$(a.c+" li").eq(a.i).addClass("active")},select:function(b,a){$(".selected").removeClass("selected");$(x(b)+" li").eq(a).addClass("selected");var c=$(".selected").offset().top,d=$(window).height(),e=$(window).scrollTop();14>=d-c+e&&$(window).scrollTop(e+28);-80<=e-c&&
$(window).scrollTop(e-28);l=$(".selected").prevAll("li").length},nowplaying:function(){a.i?$("#nowplaying").html("<span>"+a.i.title+"</span>"):$("#nowplaying").html("<span>StoPPed</span>")},currentTimePos:function(b){"reset"===b&&$("#currenttime").html("00:00 / 00:00");a.cto&&void 0!==a.cto.position&&void 0!==a.cto.durationEstimate&&($("#currenttime").html(v(a.cto.position)+" / "+v(a.cto.durationEstimate)),a.cto.durationEstimate&&a.cto.position&&$(".seek").prop("value",100/a.cto.durationEstimate*
a.cto.position))}};$("#play").on("click",function(){a.cto&&(a.cto.togglePause(),r=!r,c.buttonPress(),c.currentTimePos())});$("#prev").on("click",function(){0===a.i?1===f&&(a.i=a.l.length,e(a,a.i)):2===f?e(a,a.i):e(a,a.i-1);c.nowplaying();c.currentTimePos()});$("#next").on("click",function(){t()});$("#repeat").on("click",function(){f=(f+1)%3;c.buttonPress()});$(".volume").on("change",function(){void 0!==a.cto&&a.cto.setVolume($(".volume").val())});$(".seek").on("click",function(b){if(a.cto){var d=
$(this).parent().offset();b=b.pageX-d.left;d=$(this).width();a.cto.setPosition(b/d*a.cto.durationEstimate);c.currentTimePos()}});$("#searchbutton").click(n);$("#searchterm").keydown(function(b){13===b.keyCode&&n()});$(document).on("keydown",function(b){d(b.keyCode);38===b.keyCode&&(b.preventDefault(),0<=l-1&&c.select($(".selected").parent(),l-1));40===b.keyCode&&(b.preventDefault(),$(".selected")&&l+1<$(".searchlist li").length&&c.select($(".selected").parent(),l+1));13===b.keyCode&&(b.preventDefault(),
$(".selected")&&p())});$(".list").on("click","li",function(){c.select($(this).parent(),$(this).prevAll("li").length)});$(".list").on("dblclick","li",function(){p()});$(".list").on("click","#playbutton",function(){p()});$(".list").on("click","#addbutton",function(){s(q,k.l[$(this).parent().prevAll("li").length])});$(".list").on("click","#moveup",function(){var b=$(".selected");if(0<=b.prevAll("li").length-1){var a=b.prevAll("li").length,d=u(b.parent()),e=d[a-1];d[a-1]=d[a];d[a]=e;c.select(b.parent(),
a-1)}});$(".list").on("click","#remove",function(){d("remove");var a=$(this).parent(),e=$(this).parent().prevAll("li").length;a.l.splice(e,1);c.removeFromList(a,e)});$(document).on("mouseleave",function(){$(".selected").toggleClass("out",!0)});$(document).on("mouseenter",function(){$(".selected").toggleClass("out",!1)});setInterval(function(){c.currentTimePos()},1E3);n()});